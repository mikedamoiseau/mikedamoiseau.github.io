
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->

<head>


<meta charset="utf-8">
<meta http-equiv="cleartype" content="on">

<title>Wordpress, Des Filtres Et Des Actions (2ème Partie) - Damoiseau.ME, Le blog d&#8217;un développeur web</title>
<meta name="author" content="Michael Damoiseau">




<meta name="description" content="Des articles écrits au fur et à mesure de mes pérégrinations dans le monde du développement web">

<meta name="keywords" content="wordpress php damoiseau,damoiseau.me">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Twitter Cards -->

  
    <meta name="twitter:card" content="summary">
    <meta name="twitter:image" content"">
  
  <meta name="twitter:title" content="Wordpress, des filtres et des actions (2ème partie)">
  <meta name="twitter:description" content="Des articles écrits au fur et à mesure de mes pérégrinations dans le monde du développement web">
  <meta name="twitter:creator" content="@mike_dam">


<!-- Facebook -->
<meta property="fb:admins" content="550638906" />

<!-- Misc SEO stuff -->
<meta name="alexaVerifyID" content="9iD_etzJ6nDCsM7yizgVwQ_fSY8" />
<meta name="msvalidate.01" content="A39307D8057EC4F14EA412A8F540FB32" />
<meta name="google-site-verification" content="4JzD6y7FmLIR40JG0J-kxUBWx-gZ36_eP1QDqAwwlcQ" />

<!-- Open Graph -->
<meta property="og:locale" content="fr_FR">
<meta property="og:type" content="website">
<meta property="og:url" content="http://mikedamoiseau.github.io/wordpress-filtres-actions-partie-2">
<meta property="og:title" content="Wordpress, des filtres et des actions (2ème partie)">
<meta property="og:description" content="Des articles écrits au fur et à mesure de mes pérégrinations dans le monde du développement web">

  <meta property="og:image" content="http://mikedamoiseau.github.io">

<meta property="og:site_name" content="Damoiseau.ME, Le blog d'un développeur web">

<link rel="canonical" href="http://mikedamoiseau.github.io/wordpress-filtres-actions-partie-2">
<link href="/favicon.png" rel="icon">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
<link href="/atom.xml" rel="alternate" title="Damoiseau.ME, Le blog d'un développeur web" type="application/atom+xml">

<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>
<script>Modernizr || document.write('<script src="/javascripts/vendor/modernizr-2.6.2.custom.min.js"><\/script>') </script>



<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


</head>

<body id="post" >

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Ouvrir le menu</button>
	<ul class="dl-menu">
		<li><a href="/">Accueil</a></li>
		<li>
			<a href="#">A propos</a>
			<ul class="dl-submenu">
				<li>
					<img src="/images/damoiseau-1.jpg" alt="Michael Damoiseau photo" class="author-photo">
					<h4>Michael Damoiseau</h4>
					<p>Développeur web vivant à Chiang Mai, dans le nord de la Thaïlande</p>
				</li>
				
				
				<li>
					<a href="http://twitter.com/mike_dam"><i class="fa fa-twitter"></i> Twitter</a>
				</li>
				<li>
					<a href="http://plus.google.com/+MichaëlDamoiseau"><i class="fa fa-google-plus"></i> Google+</a>
				</li>
				<li>
					<a href="http://github.com/mikedamoiseau"><i class="fa fa-github"></i> GitHub</a>
				</li>
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Articles</a>
			<ul class="dl-submenu">
				<li><a href="/posts/">Tous les articles</a></li>
				<li><a href="/categories/">Toutes les catégories</a></li>
			</ul>
		</li>
		
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->




<div id="main" role="main">
  <article class="hentry">
    <header class="header-title">
      <div class="header-title-wrap">
        
          <h1 class="entry-title"><a href="/wordpress-filtres-actions-partie-2" rel="bookmark" title="Wordpress, des filtres et des actions (2ème partie)">Wordpress, des filtres et des actions (2ème partie)</a></h1>
        
        <h2>19/10/2014</h2>
      </div><!-- /.header-title-wrap -->
    </header>
    <div class="entry-content">
      <p>Cet article fait suite à un article écrit il y a quelques temps de celà (en fait, il y a longtemps déjà et vous m&#8217;en voyez désolé&hellip;): <a href="http://damoiseau.me/wordpress-filtres-actions-partie-1/" title="WordPress, des filtres et des actions (1ère partie)">Wordpress, des filtres et des actions (1ère partie)</a>.</p>

<p>Rappelez-vous, dans l&#8217;article précédent j&#8217;expliquais la différence entre <a href="http://codex.wordpress.org/Function_Reference/add_filter">un filtre</a> et <a href="http://codex.wordpress.org/Function_Reference/add_action">une action</a>&hellip; Un filtre est une fonction qui va recevoir un paramètre en entrée, le transformer et renvoyer le résultat de la transformation. L&#8217;action, quant à elle, reçoit 0, 1 ou plusieurs paramètres en entrée et effectue une action; cette action ne renvoie pas de résultat, ce n&#8217;est pas nécessaire.</p>

<p>Je vais vous donner un exemple concret d&#8217;utilisation de filtres et actions, repris d&#8217;un de mes projets.</p>

<!--more-->


<p>Voici le contexte: il s&#8217;agit d&#8217;une extension Wordpress transformant un site Wordpress en annuaire. Les entrées de l&#8217;annuaire peuvent être des sites internet ou des adresses physiques, et peuvent contenir un tas d&#8217;informations supplémentaires.</p>

<p>L&#8217;une de mes priorités lors de la conception de ce projet était d&#8217;écrire un noyau aussi léger que possible et facile à maintenir. J&#8217;ai donc décidé d&#8217;écrire les fonctionnalités avancées de l&#8217;extension dans des modules qui peuvent être chargés et déchargés via les options de l&#8217;extension dans l&#8217;administration du site.
Je me suis alors demandé comment rendre mon extension assez souple pour pouvoir gérer tout type de modules sans savoir encore quels genre de fonctionnalités ils allaient contenir. Et c&#8217;est là que j&#8217;ai commencé à sérieusement m&#8217;intéresser aux filtres et actions de Wordpress&hellip;</p>

<p>Je vais vous donner un exemple pratique:
Par défaut, l&#8217;annuaire ne gère que les adresses de type internet. C&#8217;est un annuaire extrêmement basique, une entrée contient un titre, une url et une description.
Pour ajouter des adresses physiques, il faut charger le module d&#8217;adresse physique. Cela va ajouter des informations supplémentaires qui seront affichées dans le template de l&#8217;extension.</p>

<p>Voici une version simplifiée du template:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="c1"># &lt;?php echo get_the_title(); ?&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;details&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;url&quot;</span><span class="o">&gt;&lt;?</span><span class="nx">php</span> <span class="k">echo</span> <span class="nv">$url</span><span class="p">;</span> <span class="cp">?&gt;</span><span class="x">&lt;/div&gt;</span>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;?php</span> <span class="nx">do_action</span><span class="p">(</span> <span class="s1">&#39;plus_de_details&#39;</span><span class="p">,</span> <span class="nx">get_the_ID</span><span class="p">()</span> <span class="p">);</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Et maintenant une version simplifiée du module gérant les adresses physiques:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">action_plus_de_details</span><span class="p">(</span> <span class="nv">$id</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="nv">$champs</span> <span class="o">=</span> <span class="nx">getExtraInfo</span><span class="p">();</span> <span class="c1">// fonction renvoyant les informations supplémentaires gérées par le module (rue, numéro, code postal, ...)</span>
</span><span class='line'>    <span class="nb">ob_start</span><span class="p">();</span>
</span><span class='line'>    <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'><span class="x">    **Rue**: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$champs</span><span class="p">[</span><span class="s1">&#39;rue&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x">       **N°**: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$champs</span><span class="p">[</span><span class="s1">&#39;numero&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="x">    **Ville**: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$champs</span><span class="p">[</span><span class="s1">&#39;ville&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x">   **Code Postal**: </span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$champs</span><span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">];</span> <span class="cp">?&gt;</span><span class="x"></span>
</span><span class='line'>
</span><span class='line'><span class="x">    </span><span class="cp">&lt;?php</span>
</span><span class='line'>    <span class="k">echo</span> <span class="nb">ob_get_clean</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">add_action</span><span class="p">(</span> <span class="s1">&#39;plus_de_details&#39;</span><span class="p">,</span> <span class="s1">&#39;action_plus_de_details&#39;</span> <span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Vous remarquerez que le template affiche seulement les informations de base d&#8217;une entrée de l&#8217;annuaire (en l&#8217;occurrence, l&#8217;url). Par contre, le template offre la possibilité d&#8217;effectuer des actions supplémentaires juste après ce champ &ldquo;Url&rdquo;, ce qui permet au module Adresse d&#8217;ajouter ses propres champs.</p>

<p>Maintenant que nous avons vu un exemple d&#8217;action, ce serait pas mal de faire de même pour les filtres, n&#8217;est-ce pas?
Continuons avec notre projet d&#8217;annuaire en ligne. Nous sommes en 2014 (c&#8217;est la date d&#8217;écriture de l&#8217;article en tout cas&hellip;) et il est pratiquement inconcevable d&#8217;utiliser un annuaire en ligne qui ne soit pas &ldquo;Oueb 2.0&rdquo;, c&#8217;est-à-dire interactif!
Une des fonctionnalités de base de tout annuaire qui se respecte est l&#8217;évaluation faite par les internautes. Notre module ajoute donc un champ permettant à l&#8217;internaute d&#8217;évaluer l&#8217;entrée de l&#8217;annuaire lors de l&#8217;ajout d&#8217;un commentaire. Cette évaluation doit s&#8217;afficher à côté du titre de l&#8217;entrée.</p>

<p>Voici une version simplifiée du template:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'># <span class="cp">&lt;?php echo apply_filters( &#39;filtre_sur_le_titre&#39;, get_the_title(), get_the_ID() ); ?&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;details&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">&quot;url&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;?php echo $url; ?&gt;</span><span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="cp">&lt;?php do_action( &#39;plus_de_details&#39;, get_the_ID() ); ?&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Et maintenant une version simplifiée du module affichant les évaluations:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">function</span> <span class="nf">mon_filtre_sur_le_titre</span><span class="p">(</span> <span class="nv">$titre</span><span class="p">,</span> <span class="nv">$post_id</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span> <span class="nx">is_singular</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">is_main_query</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="nx">in_the_loop</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="nv">$eval</span> <span class="o">=</span> <span class="nx">getEvaluation</span><span class="p">(</span> <span class="nv">$post_id</span> <span class="p">);</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">sprintf</span><span class="p">(</span> <span class="s1">&#39;%s&lt;span class=&quot;rating&quot;&gt;%d&lt;/span&gt;&#39;</span><span class="p">,</span> <span class="nv">$titre</span><span class="p">,</span> <span class="nv">$eval</span> <span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="nv">$titre</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="nx">add_filter</span><span class="p">(</span> <span class="s1">&#39;filtre_sur_le_titre&#39;</span><span class="p">,</span> <span class="s1">&#39;mon_filtre_sur_le_titre&#39;</span> <span class="p">)</span> <span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Vous aurez remarqué qu&#8217;il est extrêmement facile d&#8217;ajouter des fonctionnalités grâce à l&#8217;utilisation des actions et des filtres. L&#8217;exemple du filtre est plutôt explicite: on a pu ajouter un affichage des évaluations des visiteurs rien que grâce à l&#8217;utilisation d&#8217;un filtre! C&#8217;est-y pas beau ça?</p>

<p><em>Si vous voulez jeter un oeil à mon extension d&#8217;évaluation, <a href="https://github.com/mikedamoiseau/my-wp-comment-rating">mon répertoire Github </a>vous accueillera à bras ouverts :)</em></p>

      <footer class="entry-meta">
        <span class="entry-tags"><a href="/categories/#wordpress" title="Pages tagged wordpress" class="tag">wordpress</a><a href="/categories/#php" title="Pages tagged php" class="tag">php</a></span>
        <span><a href="/wordpress-filtres-actions-partie-2" rel="bookmark" title="Wordpress, des filtres et des actions (2ème partie)">Wordpress, des filtres et des actions (2ème partie)</a> was published on <span class="entry-date date published updated"><time datetime="2014-10-19T13:43:16+07:00">October 19, 2014</time></span></span>
        
        <span class="author vcard"><span class="fn"><a href="" title="About Michael Damoiseau">Michael Damoiseau</a></span></span>
        
      </footer>
    </div><!-- /.entry-content -->
    
      <div class="read-more">
        
          <div class="read-more-header">
            <a href="/reecriture-blog-jekyll-octopress-bonne-annee-2015" class="btn">Continuer la lecture</a>
          </div><!-- /.read-more-header -->
          <div class="read-more-content">
            <h3><a href="/reecriture-blog-jekyll-octopress-bonne-annee-2015" title="Réécriture du blog avec Jekyll/Octopress et Bonne année 2015">Réécriture du blog avec Jekyll/Octopress et Bonne année 2015</a></h3>
            <p>Pour terminer l&#8217;année en beauté, j&#8217;ai décidé de réécrire complètement le moteur du blog. Adieu Wordpress, et bienvenue Jekyll!Ca faitsait &hellip;&hellip; <a href="/reecriture-blog-jekyll-octopress-bonne-annee-2015"> Continuer la lecture</a></p>
          </div><!-- /.read-more-content -->
        
        <div class="read-more-list">
          
            <div class="list-item">
              <h4><a href="/wordpress-4.1-disponible-au-telechargement" title="Wordpress 4.1 disponible au téléchargement">Wordpress 4.1 disponible au téléchargement</a></h4>
              <span>Publié le 21/12/2014</span>
            </div><!-- /.list-item -->
          
            <div class="list-item">
              <h4><a href="/tester-le-rendu-de-votre-site-internet-simultanement-sur-plusieurs-peripheriques-avec-browsersync" title="Tester le rendu de votre site internet simultanément sur plusieurs périphériques avec BrowserSync">Tester le rendu de votre site internet simultanément sur plusieurs périphériques avec BrowserSync</a></h4>
              <span>Publié le 30/10/2014</span>
            </div><!-- /.list-item -->
          
        </div><!-- /.read-more-list -->
      </div><!-- /.read-more -->
    
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2014 Michael Damoiseau. Powered by <a href="http://octopress.org">Octopress</a> using the <a href="https://github.com/Z1MM32M4N/hpstr-theme/">HPSTR Theme for Octopress</a>.</span>

  </footer>
</div><!-- /.footer-wrapper -->



<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/javascripts/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/javascripts/octopress.js" type="text/javascript"></script>
<script src="/javascripts/scripts.min.js"></script>

  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43047575-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>




<script type="text/javascript">
      var disqus_shortname = 'damoiseaume';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://mikedamoiseau.github.io/wordpress-filtres-actions-partie-2';
        var disqus_url = 'http://mikedamoiseau.github.io/wordpress-filtres-actions-partie-2';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>




</body>
</html>
